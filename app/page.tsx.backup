'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import FeaturedBusinessCarousel from '@/components/FeaturedBusinessCarousel';
import ListingCard from '@/components/ListingCard';

interface HomepageData {
  featuredBusinesses: any[];
  latestArticles: any[];
  upcomingEvents: any[];
  latestJobs: any[];
  stats: {
    businessCount: number;
    jobCount: number;
    eventCount: number;
  };
}

export default function Home(){
  const router = useRouter();
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [isMobile, setIsMobile] = useState(true);
  const [homepageData, setHomepageData] = useState<HomepageData | null>(null);
  const [activeTab, setActiveTab] = useState<'articles' | 'businesses' | 'events' | 'jobs'>('articles');

  useEffect(() => {
    const handleResize = () => {
      setIsMobile(window.innerWidth < 768);
    };
    handleResize();
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  useEffect(() => {
    async function fetchHomepageData() {
      try {
        const response = await fetch('/api/homepage/featured');
        const result = await response.json();
        if (result.success) {
          setHomepageData(result.data);
        }
      } catch (error) {
        console.error('Failed to fetch homepage data:', error);
      }
    }
    fetchHomepageData();
  }, []);

  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault();
    if (!searchQuery.trim()) return;
    
    const params = new URLSearchParams();
    params.set('q', searchQuery);
    if (selectedCategory !== 'all') {
      params.set('category', selectedCategory);
    }
    
    // Route to directory/search
    router.push(`/directory?${params.toString()}`);
  };

  return (
    <section>
      {/* Hero Banner with Search */}
      <div style={{
        background: 'linear-gradient(135deg, rgba(0,102,179,0.75) 0%, rgba(200,90,23,0.75) 100%), url(https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1400&h=500&fit=crop?q=80) center/cover',
        backgroundBlendMode: 'overlay',
        minHeight: '500px',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        color: 'white',
        textAlign: 'center',
        padding: '40px 20px',
        marginBottom: '40px'
      }}>
        <div style={{ maxWidth: '900px', width: '100%' }}>
          <h1 style={{ fontSize: 'clamp(2em, 5vw, 3.5em)', margin: '0 0 20px 0', fontWeight: 800 }}>Welcome to the Bay Islands Hub</h1>
          <p style={{ fontSize: 'clamp(1em, 2vw, 1.3em)', margin: '0 0 32px 0', opacity: 0.95 }}>Discover local businesses, jobs, events and community across South Morton Bay</p>
          
          {/* Responsive Search Bar */}
          <form onSubmit={handleSearch} style={{ width: '100%', maxWidth: '700px', margin: '0 auto' }}>
            <div style={{
              display: 'grid',
              gridTemplateColumns: isMobile ? '1fr' : '1fr auto',
              gap: '12px',
              alignItems: 'stretch'
            }}>
              {/* Search Input */}
              <div style={{
                position: 'relative',
                display: 'flex',
                alignItems: 'center'
              }}>
                <input
                  type="text"
                  placeholder="Search local events, jobs, businesses..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  style={{
                    width: '100%',
                    padding: '14px 16px',
                    fontSize: 'clamp(13px, 2.5vw, 15px)',
                    border: 'none',
                    borderRadius: isMobile ? '8px' : '8px 0 0 8px',
                    outline: 'none',
                    color: '#0b1727',
                    fontWeight: 500,
                    backgroundColor: 'white',
                    boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
                    minHeight: '48px'
                  }}
                />
              </div>
              
              {/* Search Button */}
              <button
                type="submit"
                style={{
                  padding: '14px 24px',
                  background: '#10b981',
                  color: 'white',
                  border: 'none',
                  borderRadius: isMobile ? '8px' : '0 8px 8px 0',
                  cursor: 'pointer',
                  fontWeight: 700,
                  fontSize: 'clamp(13px, 2.5vw, 15px)',
                  minHeight: '48px',
                  boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
                  transition: 'all 0.2s',
                  whiteSpace: 'nowrap'
                }}
                onMouseEnter={(e) => {
                  (e.currentTarget as HTMLElement).style.background = '#059669';
                }}
                onMouseLeave={(e) => {
                  (e.currentTarget as HTMLElement).style.background = '#10b981';
                }}
              >
                ğŸ” Search
              </button>
            </div>
            
            {/* Category Filters - Hidden on Mobile, Visible on Tablet+ */}
            {!isMobile && (
              <div style={{
                display: 'flex',
                gap: '12px',
                marginTop: '12px',
                justifyContent: 'center',
                flexWrap: 'wrap',
                fontSize: '13px'
              }}>
                {[
                  { value: 'all', label: 'All Categories' },
                  { value: 'businesses', label: 'ğŸ¢ Businesses' },
                  { value: 'jobs', label: 'ğŸ’¼ Jobs' },
                  { value: 'events', label: 'ğŸ‰ Events' },
                  { value: 'classifieds', label: 'ğŸ›’ Classifieds' }
                ].map(category => (
                  <label key={category.value} style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px',
                    cursor: 'pointer',
                    background: selectedCategory === category.value ? 'rgba(255,255,255,0.3)' : 'rgba(255,255,255,0.1)',
                    padding: '8px 12px',
                    borderRadius: '6px',
                    transition: 'all 0.2s'
                  }}
                    onMouseEnter={(e) => {
                      (e.currentTarget as HTMLElement).style.background = 'rgba(255,255,255,0.2)';
                    }}
                    onMouseLeave={(e) => {
                      (e.currentTarget as HTMLElement).style.background = selectedCategory === category.value ? 'rgba(255,255,255,0.3)' : 'rgba(255,255,255,0.1)';
                    }}
                  >
                    <input
                      type="radio"
                      name="category"
                      value={category.value}
                      checked={selectedCategory === category.value}
                      onChange={(e) => setSelectedCategory(e.target.value)}
                      style={{ cursor: 'pointer', accentColor: '#10b981' }}
                    />
                    <span style={{ color: 'white', fontWeight: 500 }}>{category.label}</span>
                  </label>
                ))}
              </div>
            )}
          </form>
        </div>
      </div>

      <div className="hero container">
        <div style={{flex:1}}>
          <h2>Your Local Community Hub</h2>
          <p className="muted" style={{maxWidth: '720px'}}>Trusted guide for the South Moreton Bay Islands â€” Russell, Macleay, Lamb, Karragarra and Redland Bay. Discover verified local businesses, events, jobs, services, and classifieds with fresh listings posted weekly.</p>
          <p className="muted" style={{marginTop: '8px', fontWeight: 600}}>Articles â€¢ Jobs â€¢ Community Events â€¢ Business Directory â€¢ Buy & Sell â€¢ Island Guides â€¢ Council & Transport Updates</p>
        </div>
        <div style={{minWidth:'280px'}}>
          <div className="card">
            <h3>Get started</h3>
            <p className="muted" style={{marginBottom: '12px'}}>Create free listings, post jobs, add events, and connect with locals across SMBI in minutes.</p>
            <p className="muted" style={{marginBottom: '16px'}}>Built for residents, tradies, small businesses, clubs, and visitors looking for trusted local information.</p>
            <div style={{display:'flex', gap:'10px', flexWrap:'wrap'}}>
              <a href="/signup" style={{background:'#0066b3', color:'white', padding:'10px 18px', borderRadius:'8px', textDecoration:'none', fontWeight:700, boxShadow:'0 4px 10px rgba(0,102,179,0.25)'}}>Sign up free</a>
              <a href="/login" style={{background:'transparent', color:'#0066b3', padding:'10px 18px', borderRadius:'8px', textDecoration:'none', fontWeight:700, border:'2px solid #0066b3'}}>Sign in</a>
            </div>
          </div>
        </div>
      </div>

      {/* Discover the Islands Section */}
      <section style={{padding:'clamp(40px, 8vw, 60px) 0', background:'#f8fafc'}}>
        <div className="container">
          <h2>Explore the Islands ğŸï¸</h2>
          <p className="muted" style={{maxWidth:600, marginBottom:32}}>The South Moreton Bay Islands (Russell, Macleay, Lamb & Karragarra) offer island living with mainland convenience. Discover each island's unique character, amenities, and lifestyle.</p>
          
          <div className="grid" style={{marginTop:12, marginBottom:40}}>
            <a href="/islands/russell" className="card" style={{textDecoration: 'none', color: 'inherit', cursor: 'pointer'}}>
              <h3>ğŸï¸ Russell Island</h3>
              <p className="muted">The hub with shops, schools, and community. Population 2,000+</p>
            </a>
            <a href="/islands/macleay" className="card" style={{textDecoration: 'none', color: 'inherit', cursor: 'pointer'}}>
              <h3>â›³ Macleay Island</h3>
              <p className="muted">Upscale & serene with golf, fine dining & art. Population 1,200+</p>
            </a>
            <a href="/islands" className="card" style={{textDecoration: 'none', color: 'inherit', cursor: 'pointer'}}>
              <h3>ğŸŒ´ All Islands Guide</h3>
              <p className="muted">Complete guides to Lamb & Karragarra plus island comparisons.</p>
            </a>
          </div>
          <div style={{textAlign:'center'}}>
            <a href="/islands" style={{color:'#0066b3', fontWeight:600, fontSize:'1.05em', textDecoration:'none'}}>View complete islands guide â†’</a>
          </div>
        </div>
      </section>

      <section style={{padding:'24px 0'}}>
        <div className="container">
          <h2>Popular sections</h2>
          <div className="grid" style={{marginTop:12}}>
            <a href="/articles" className="card" style={{textDecoration: 'none', color: 'inherit', cursor: 'pointer'}}>
              <h3>ğŸ“° Articles</h3>
              <p className="muted">Local news and guides for SMBI residents and visitors.</p>
            </a>
            <a href="/jobs" className="card" style={{textDecoration: 'none', color: 'inherit', cursor: 'pointer'}}>
              <h3>ğŸ’¼ Jobs</h3>
              <p className="muted">Jobs in hospitality, retail and services across the islands.</p>
            </a>
            <a href="/events" className="card" style={{textDecoration: 'none', color: 'inherit', cursor: 'pointer'}}>
              <h3>ğŸ‰ Events</h3>
              <p className="muted">Community events, markets, and island gatherings.</p>
            </a>
            <a href="/classifieds" className="card" style={{textDecoration: 'none', color: 'inherit', cursor: 'pointer'}}>
              <h3>ğŸ›’ Buy & Sell</h3>
              <p className="muted">Classifieds marketplace for furniture, boats, cars and more.</p>
            </a>
          </div>
        </div>
      </section>

      {/* Featured Content Section */}
      <section style={{padding:'clamp(40px, 8vw, 60px) 0', background:'#fff'}}>
        <div className="container">
          <h2>Why Living on the Bay Islands?</h2>
          <p className="muted" style={{maxWidth:700, marginBottom:32}}>Island life blends relaxed charm with modern amenities. Here's why people choose the South Moreton Bay Islands:</p>
          
          <div className="grid" style={{marginTop:12}}>
            <div className="card">
              <h3>ğŸ˜ï¸ Tight-Knit Community</h3>
              <p className="muted">Active clubs, weekly markets, festivals, and genuine local connections.</p>
            </div>
            <div className="card">
              <h3>â›³ Recreation & Lifestyle</h3>
              <p className="muted">Golf, bowls, boating, water sports, walking trails, and outdoor clubs.</p>
            </div>
            <div className="card">
              <h3>ğŸ« Quality Education</h3>
              <p className="muted">Island schools with community focus + easy mainland access for secondary.</p>
            </div>
            <div className="card">
              <h3>ğŸŒ¿ Natural Beauty</h3>
              <p className="muted">Beaches, wildlife, heritage trails, nature reserves & sustainable living.</p>
            </div>
            <div className="card">
              <h3>ğŸ’¼ Work & Employment</h3>
              <p className="muted">Local jobs + growing remote work opportunities with excellent internet.</p>
            </div>
            <div className="card">
              <h3>ğŸ¡ Property Investment</h3>
              <p className="muted">Growing demand for island properties from $700k to luxury beachfront homes.</p>
            </div>
          </div>
        </div>
      </section>

      {/* CTA Section */}
      <section style={{padding:'clamp(40px, 8vw, 60px) 0', background:'linear-gradient(135deg, #0066b3 0%, #c85a17 100%)', color:'white'}}>
        <div className="container" style={{textAlign:'center'}}>
          <h2 style={{color:'white', marginBottom:16}}>Ready to Explore Island Living?</h2>
          <p style={{opacity:0.95, marginBottom:32, maxWidth:600, marginLeft:'auto', marginRight:'auto'}}>Browse properties, jobs, community events, and local directory listings</p>
          
          <div style={{display:'flex', gap:'12px', justifyContent:'center', flexWrap:'wrap'}}>
            <a href="/classifieds" style={{background:'white', color:'#0066b3', padding:'12px 28px', borderRadius:8, textDecoration:'none', fontWeight:600, cursor:'pointer', minHeight:'44px', display:'flex', alignItems:'center'}}>
              View Properties
            </a>
            <a href="/jobs" style={{background:'rgba(255,255,255,0.2)', color:'white', padding:'12px 28px', borderRadius:8, textDecoration:'none', fontWeight:600, border:'2px solid white', cursor:'pointer', minHeight:'44px', display:'flex', alignItems:'center'}}>
              Browse Jobs
            </a>
            <a href="/directory" style={{background:'rgba(255,255,255,0.2)', color:'white', padding:'12px 28px', borderRadius:8, textDecoration:'none', fontWeight:600, border:'2px solid white', cursor:'pointer', minHeight:'44px', display:'flex', alignItems:'center'}}>
              Business Directory
            </a>
          </div>
        </div>
      </section>
    </section>
  )
}
